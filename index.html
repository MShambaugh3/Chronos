<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chronos Tool - Add Task/Event</title>
  <script type="module">
    import { database } from './firebaseConfig.js';
    import { ref, push, set } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

    const taskTypeSelect = document.getElementById("task-type");
    const taskInput = document.getElementById("task-input");
    const eventDateInput = document.getElementById("event-date");
    const eventTimeInput = document.getElementById("event-time");
    const executeButton = document.getElementById("execute-button");

    // Function to save a task or event
    function saveEntry(type, category, content, date = null, time = null) {
      const entryRef = ref(database, `entries/${category}`);
      const newEntryRef = push(entryRef);

      const entryData = {
        content: content,
        type: type,
        completed: false,
        date: date,
        time: time,
      };

      set(newEntryRef, entryData)
        .then(() => {
          displayMessage(`${type.charAt(0).toUpperCase() + type.slice(1)} "${content}" added to "${category}".`);
        })
        .catch((error) => {
          displayMessage("Error adding entry: " + error.message, 'error');
        });
    }

    // Event handler for adding task or event
    executeButton.addEventListener("click", () => {
      const category = document.getElementById("category").value;
      const content = taskInput.value.trim();
      const type = taskTypeSelect.value;
      let date = null, time = null;

      if (type === "event") {
        date = eventDateInput.value;
        time = eventTimeInput.value;
      }

      if (content) {
        saveEntry(type, category, content, date, time);
      } else {
        displayMessage("Please enter a valid task or event.");
      }

      taskInput.value = ""; // Clear input
      eventDateInput.value = ""; // Clear date input
      eventTimeInput.value = ""; // Clear time input
    });

    // Function to display messages
    function displayMessage(message, type = 'success') {
      const messageDisplay = document.getElementById("message-display");
      messageDisplay.innerHTML = `<p class="${type}">${message}</p>`;
    }
  </script>
</head>
<body>
  <header>
    <nav>
      <a href="index.html">Home</a>
      <a href="taskview.html">Task View</a>
    </nav>
  </header>
  <main>
    <h2>Add Task/Event</h2>
    
    <div>
      <label for="task-type">Task or Event:</label>
      <select id="task-type">
        <option value="task">Task</option>
        <option value="event">Event</option>
      </select>
    </div>

    <div>
      <label for="category">Category:</label>
      <select id="category">
        <option value="school">School</option>
        <option value="life">Life</option>
        <option value="AFROTC">AFROTC</option>
        <option value="misc">Miscellaneous</option>
      </select>
    </div>

    <div>
      <label for="task-input">Task/Event Content:</label>
      <input type="text" id="task-input" placeholder="Enter task or event" />
    </div>

    <div id="event-fields" style="display: none;">
      <label for="event-date">Event Date:</label>
      <input type="date" id="event-date" />
      
      <label for="event-time">Event Time:</label>
      <input type="time" id="event-time" />
    </div>

    <button id="execute-button">Add Task/Event</button>

    <div id="message-display"></div>
  </main>
</body>
</html>
